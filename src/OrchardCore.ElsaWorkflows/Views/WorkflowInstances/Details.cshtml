@using OrchardCore.Mvc.Core.Utilities
@using OrchardCore.ElsaWorkflows.BlazorComponents.Components
@model OrchardCore.ElsaWorkflows.Controllers.WorkflowInstances.Details.WorkflowInstanceViewModel
@addTagHelper *, Microsoft.AspNetCore.Mvc.TagHelpers

<!-- Manifest & fonts -->
<link rel="manifest" asp-src="~/OrchardCore.ElsaWorkflows/_content/Elsa.Studio.Shell/site.webmanifest" />
<link rel="preconnect" asp-src="https://fonts.googleapis.com" />
<link rel="preconnect" asp-src="https://fonts.gstatic.com" crossorigin />
<link asp-src="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700&display=swap" rel="stylesheet" />
<link asp-src="https://fonts.googleapis.com/css2?family=Ubuntu:wght@300;400;500;700&display=swap" rel="stylesheet" />
<link asp-src="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700&display=swap" rel="stylesheet" />
<link asp-src="https://fonts.googleapis.com/css2?family=Grandstander:wght@100&display=swap" rel="stylesheet" />

<!-- RCL static assets (always from root /_content) -->
<link asp-src="~/_content/MudBlazor/MudBlazor.min.css" rel="stylesheet" />
<link asp-src="~/_content/CodeBeam.MudBlazor.Extensions/MudExtensions.min.css" rel="stylesheet" />
<link asp-src="~/_content/Radzen.Blazor/css/material-base.css" rel="stylesheet" />
<link asp-src="~/_content/Elsa.Studio.Shell/css/shell.css" rel="stylesheet" />

<!-- Blazor WASM component -->
<component type="typeof(WorkflowEditorOrInstanceWrapper)"
           render-mode="WebAssembly"
           param-RemoteEndpoint="@Url.ToAbsoluteUrl("~/elsa/api")"
           param-WorkflowInstanceId="@Model.WorkflowInstance.Id" />

<!-- Error UI -->
<div id="blazor-error-ui">
  An unhandled error has occurred.
  <a href="" class="reload">Reload</a>
  <a class="dismiss">ðŸ—™</a>
</div>

<!-- Monaco & supporting scripts -->
<script at="Foot" depends-on="monaco, admin" asp-name="elsamonaco">
  require(['vs/editor/editor.main'], function () { /* Monaco loaded */ });
</script>
<script asp-src="~/_content/BlazorMonaco/jsInterop.js" at="Foot" depends-on="elsamonaco"></script>
<script asp-src="~/_content/MudBlazor/MudBlazor.min.js" at="Foot"></script>
<script asp-src="~/_content/CodeBeam.MudBlazor.Extensions/MudExtensions.min.js" at="Foot"></script>
<script asp-src="~/_content/Radzen.Blazor/Radzen.Blazor.js" at="Foot"></script>

<!-- Bootstrap the WASM runtime from your module base path -->
<script src="~/OrchardCore.ElsaWorkflows/_framework/blazor.webassembly.js" autostart="false"></script>
<script at="Foot">
    const basePath = '@Url.Content("~/OrchardCore.ElsaWorkflows")';

    document.addEventListener('DOMContentLoaded', function () {
        Blazor.start({
            loadBootResource: function (type, name, defaultUri, integrity) {
                console.log('loadBootResource', type, name, defaultUri, integrity);
                switch (name) {
                    case 'dotnet.js':
                        return `${basePath}/${defaultUri}`;
                }

                return defaultUri;
            }
        });
    });
</script>
